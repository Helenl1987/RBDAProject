## copy the data into HDFS on dumbo
## command: scp 'DATA_SOURCE_LOCATION' jl10005@dumbo.es.its.nyu.edu:/home/jl10005/project/

#command - create table for business
create external table business (hours_Monday string, hours_Thursday string, hours_Friday string, hours_Wednesday string, hours_Tuesday string, hours_Saturday string, address string, city string, is_open int, latitude double, review_count int, stars double, name string, attributes_BikeParking string, attributes_BusinessAcceptsCreditCards string, attributes_RestaurantsDelivery string, attributes_BusinessParking_garage string, attributes_BusinessParking_street string, attributes_BusinessParking_validated string, attributes_BusinessParking_lot string, attributes_BusinessParking_valet string, attributes_NoiseLevel string, attributes_RestaurantsGoodForGroups string, attributes_RestaurantsPriceRange2 string, attributes_RestaurantsReservations string, attributes_RestaurantsTakeOut string, attributes_GoodForKids string, attributes_RestaurantsAttire string, attributes_HasTV string, attributes_OutdoorSeating string, neighborhood string, state string, categories string, postal_code string, business_id string, longitude double, hours_Sunday string, attributes_RestaurantsTableService string, attributes_Alcohol string, attributes_WheelchairAccessible string, attributes_Caters string, attributes_WiFi string, attributes_GoodForMeal_dessert string, attributes_GoodForMeal_latenight string, attributes_GoodForMeal_lunch string, attributes_GoodForMeal_dinner string, attributes_GoodForMeal_breakfast string, attributes_GoodForMeal_brunch string, attributes_Ambience_romantic string, attributes_Ambience_intimate string, attributes_Ambience_classy string, attributes_Ambience_hipster string, attributes_Ambience_touristy string, attributes_Ambience_trendy string, attributes_Ambience_upscale string, attributes_Ambience_casual string, hours string, attributes_Ambience_divey string) row format delimited fields terminated by '\t' location 'LOCATION'

#command - create table for review
create external table review (review_id string, user_id string, business_id string, stars double, dates string, text string, useful int, funny int, cool int) row format delimited fields terminated by '\t' location '/user/REPLACE_BY_FILE_LOCATION';

#command - create table for tip
create external table tip (text string, date string, likes int, business_id string, user_id string) row format delimited fields terminated by '\t' location '/user/REPLACE_BY_FILE_LOCATION';

#command - create table for yelp rating
create external table rating_details (name string, address string, business_id string,  zip string, neighborhood string, city string, state string, review_sum  int,  star_5  int,  star_4  int,  star_3  int,  star_2  int,  star_1  int,  has_trend  int, 2018_10  double,  2018_9  double,  2018_8  double, 2018_7  double,  2018_6  double,  2018_5  double,  2018_4  double,  2018_3  double, 2018_2  double,  2018_1  double,  2018_0  double, 2017_11  double,  2017_10  double,  2017_9  double,  2017_8  double,  2017_7  double,  2017_6  double,  2017_5  double,  2017_4  double,  2017_3  double,  2017_2  double,  2017_1  double,  2017_0  double, 2016_11  double,  2016_10  double,  2016_9  double,  2016_8  double,  2016_7  double,  2016_6  double,  2016_5  double,  2016_4  double,  2016_3  double,  2016_2  double,  2016_1  double,  2016_0  double, 2015_11  double,  2015_10  double,  2015_9  double,  2015_8  double,  2015_7  double,  2015_6  double,  2015_5  double,  2015_4  double,  2015_3  double,  2015_2  double,  2015_1  double,  2015_0  double, 2014_11  double,  2014_10  double,  2014_9  double,  2014_8  double,  2014_7  double,  2014_6  double,  2014_5  double,  2014_4  double,  2014_3  double,  2014_2  double,  2014_1  double,  2014_0  double) row format delimited fields terminated by '\t' location '/user/REPLACE_BY_FILE_LOCATION';

#checkins.txt:
impala-shell --user=zl2521 -i compute-1-1:21000 -B -q "use zl2521; select business_id, user_id, dates from review” -o checkins_review.txt '--output_delimiter=\t'
impala-shell --user=zl2521 -i compute-1-1:21000 -B -q "use zl2521; select business_id, user_id, dates from tip” -o checkins_tip.txt '--output_delimiter=\t'
cat checkins_review.txt checkins_tip.txt > checkins.txt

#table simcheckin by checkins.txt:
create external table simcheckin (business_id string, user_id string, dates string) row format delimited fields terminated by '\t' location '/user/zl2521/project/impala_simcheckin';

#categories_output:
javac -classpath `yarn classpath`:. -d . NormalCate.java
jar -cvf NormalCate.jar *.class
hdfs dfs -rm -r /user/zl2521/project/categories_output
hadoop jar NormalCate.jar NormalCate  /user/zl2521/project/ingest_business.txt /user/zl2521/project/categories_output

#table business_all by categories_output:
create external table business_all (hours_Monday string, hours_Thursday string, hours_Friday string, hours_Wednesday string, hours_Tuesday string, hours_Saturday string, address string, city string, is_open string, latitude double, review_count int, stars double, name string, attributes_BikeParking string, attributes_BusinessAcceptsCreditCards string, attributes_RestaurantsDelivery string, attributes_BusinessParking_garage string, attributes_BusinessParking_street string, attributes_BusinessParking_validated string, attributes_BusinessParking_lot string, attributes_BusinessParking_valet string, attributes_NoiseLevel string, attributes_RestaurantsGoodForGroups string, attributes_RestaurantsPriceRange2 string, attributes_RestaurantsReservations string, attributes_RestaurantsTakeOut string, attributes_GoodForKids string, attributes_RestaurantsAttire string, attributes_HasTV string, attributes_OutdoorSeating string, neighborhood string, state string, categories string, postal_code string, business_id string, longitude double, hours_Sunday string, attributes_RestaurantsTableService string, attributes_Alcohol string, attributes_WheelchairAccessible string, attributes_Caters string, attributes_DriveThru string, attributes_DogsAllowed string, attributes_WiFi string, attributes_GoodForMeal_dessert string, attributes_GoodForMeal_latenight string, attributes_GoodForMeal_lunch string, attributes_GoodForMeal_dinner string, attributes_GoodForMeal_breakfast string, attributes_GoodForMeal_brunch string, attributes_Ambience_romantic string, attributes_Ambience_intimate string, attributes_Ambience_classy string, attributes_Ambience_hipster string, attributes_Ambience_touristy string, attributes_Ambience_trendy string, attributes_Ambience_upscale string, attributes_Ambience_casual string, hours string, attributes string, attributes_Ambience_divey string, attributes_BestNights_monday string, attributes_BestNights_tuesday string, attributes_BestNights_friday string, attributes_BestNights_wednesday string, attributes_BestNights_thursday string, attributes_BestNights_sunday string, attributes_BestNights_saturday string, attributes_GoodForDancing string, attributes_CoatCheck string, attributes_HappyHour string, attributes_BYOB string, attributes_Music_dj string, attributes_Music_background_music string, attributes_Music_no_music string, attributes_Music_karaoke string, attributes_Music_live string, attributes_Music_video string, attributes_Music_jukebox string, attributes_BYOBCorkage string, attributes_Corkage string, attributes_Smoking string, attributes_ByAppointmentOnly string, attributes_HairSpecializesIn_coloring string, attributes_HairSpecializesIn_africanamerican string, attributes_HairSpecializesIn_curly string, attributes_HairSpecializesIn_perms string, attributes_HairSpecializesIn_kids string, attributes_HairSpecializesIn_extensions string, attributes_HairSpecializesIn_asian string, attributes_HairSpecializesIn_straightperms string, attributes_AcceptsInsurance string, attributes_BusinessAcceptsBitcoin string, attributes_AgesAllowed string, attributes_RestaurantsCounterService string, attributes_Open24Hours string, attributes_DietaryRestrictions_dairy_free string, attributes_DietaryRestrictions_gluten_free string, attributes_DietaryRestrictions_vegan string, attributes_DietaryRestrictions_kosher string, attributes_DietaryRestrictions_halal string, attributes_DietaryRestrictions_soy_free string, attributes_DietaryRestrictions_vegetarian string, cate_normal string) row format delimited fields terminated by '\t' location '/user/zl2521/project/categories_output';

#business_open.txt:
impala-shell --user=zl2521 -i compute-1-1:21000 -B -q "use zl2521; select business_id, min(dates)  from review group by business_id” -o bussiness_open.txt '--output_delimiter=\t'

#table business_open by business_open.txt:
create external table business_open (business_id string, dates string) row format delimited fields terminated by '\t' location '/user/zl2521/project/impala_business_open';

#mobile_feature.py input data generation:
impala-shell --user=zl2521 -i compute-1-1:21000 -B -q "use zl2521; select simcheckin.business_id, simcheckin.user_id, simcheckin.dates, business_all.main_cate from simcheckin, business_all where simcheckin.business_id = business_all.business_id and business_all.city = ‘CITYNAME’” -o checkin_CITYNAME.txt '--output_delimiter=\t'

#geo_feature.py input data generation:
impala-shell --user=zl2521 -i compute-1-1:21000 -B -q "use zl2521; select business_all.name, business_all.neighborhood, business_all.business_id, business_all.main_cate, business_all.cate_count, business_all.longitude,business_all.latitude,business_all.cuisines,business_all.cuisine_count,business_open.dates from zl2521.business_all,zl2521.business_open where business_all.city=CITYNAME and business_all.business_id=business_open.business_id" -o bussiness_CITYNAME.txt '--output_delimiter=\t'




